$(document).ready(function() {
	console.log("dashboard");
	checkSession();
});

async function checkSession() {
    try {
	    const response = await fetch('/user/session', {
	     	method: 'GET'
	    });
       const data = await response.json();
       if (data.success) {
           	console.log(data);
			console.log(window.location.pathname);
			sessionStorage.setItem("user", JSON.stringify({ email: data.data.email, id: data.data.id, name: data.data.name, partnerName: data.data.partner_name, address: data.data.address, image: data.data.image}));
			console.log(sessionStorage);
			if(window.location.pathname == "/home.html") window.location.href = '../html/dashboard.html';
       } else {
			if(window.location.pathname != "/home.html") {
				window.location.href = '../home.html'; // Redirect to home page
				alert('Session expired or unauthorized.');
			}
       }
   } catch (error) {
       console.log(error);
       alert(error.message);
   }
}
document.addEventListener("DOMContentLoaded", function () {
    setTimeout(() => {
        let navLinks = document.querySelectorAll(".user-nav-menu a");

        if (navLinks.length === 0) {
            console.error("No nav links found. Check class names or script execution order.");
            return;
        }
        let currentPath = window.location.href.split("/").pop().split("?")[0]; // More robust
        let queryParams = new URLSearchParams(window.location.search);
        let currentType = queryParams.get("type");
        console.log("Current page:", currentPath); // Debugging
        console.log("Current type:", currentType);

        let isActiveSet = false;

        navLinks.forEach(link => {
            let linkPath = link.getAttribute("href").split("/").pop().split("?")[0];
            let linkParams = new URLSearchParams(link.getAttribute("href").split("?")[1]);
            let linkType = linkParams.get("type");

            console.log(`Checking link: ${linkPath}, Type: ${linkType}`);

            if (currentPath === linkPath && currentType === linkType) {
                navLinks.forEach(l => l.classList.remove("active"));
                link.classList.add("active");
                isActiveSet = true;
                console.log(`Active set for: ${linkPath}`);
            }
        });

        if (!isActiveSet) {
            navLinks.forEach(link => {
                let linkPath = link.getAttribute("href").split("/").pop().split("?")[0];
                if (currentPath === linkPath) {
                    navLinks.forEach(l => l.classList.remove("active"));
                    link.classList.add("active");
                    console.log(`Fallback active set for: ${linkPath}`);
                }
            });
        }

    }, 100);
});
